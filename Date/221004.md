221004
======

# JPA 연관 관계 (단방향 / 양방향, 일대일, 일대다, 다대다)

## JPA에서 가장 중요한 것

JPA에서 가장 중요한 것은 `객체와 관계형 데이터베이스 테이블이 어떻게 매핑되는지 이해하는 것` 이다. <br>
왜냐하면 JPA의 목적인 "객체 지향 프로그래밍과 데이터베이스 사이의 패러다임 불일치를 해결" 이라는 것과 가장 직접적으로 연관 되어 있기 때문이다. <br>
Hibernate Document 에서도 객체와 테이블 매핑이 전체 스크롤에서 차지하는 비중만 봐도 객체와 테이블 매핑의 중요성을 짐작할 수 있다. <br>
그러나 객체와 테이블 매핑에 대한 내용을 조금 더 구체적으로 나누면 컬럼, 타입, 테이블 등에 대한 1차원적인 매핑과 테이블 간의 연관 관계 매핑으로 나눌 수 있다. <br>
1차원적인 매핑의 경우에는 `@Entity`, `@Column`, `@Id`, `@GeneratedValue`, `@Enumerated` 등 말 그대로 객체와 데이터베이스 사이의 일대일로 대응되는 것이다.

연관 관계 매핑은 비지니스 로직, 비지니스 요구사항에 따라 개발자가 더 적절한 관계 설정 방법을 선택해야 한다.

<br>

## 연관 관계 정의 규칙

연관 관계를 매핑할 때, 생각해야할 것은 크게 3가지이다.

* 방향 : 단방향, 양방향 (객체 참조)
* 연관 관계의 주인 : 양방향일 때, 연관 관계에서 관리 주체
* 다중성 : 다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:M)

### 단방향, 양방향

데이터베이스 테이블은 외래 키 하나로 양 쪽 테이블 조인이 가능하다. <br>
따라서 데이터베이스는 단방향 양방향을 나눌 필요가 없다. <br>
그러나 객체는 참조용 필드가 있는 객체만 다른 객체를 참조하는 것이 가능하다. <br>
그렇기에 두 객체 사이에 하나의 객체만 참조용 필드를 가지고 참조하면 단방향 관계, <br>
두 객체 모두가 각각 참조용 필드를 가지고 참조하면 양방향 광계라고 한다. <br>
JPA를 사용하여 데이터베이스와 패러다임을 맞추기 위해 객체는 단방향 연관 관계를 가질지, 양방향 연관 관계를 가질지 선택해야 한다.
비즈니스 로직에서 두 객체가 참조가 필요한지 여부를 보고 선택하면 된다.

* Board.getPost() 처럼 참조가 필요하면 Board -> Post 단방향 참조
* Post.getBoard() 처럼 참조가 필요하면 Post -> Board 단방향 참조

이런 식으로 비즈니스 로직에 맞게 선택했는데 두 객체가 서로 단방향 참조를 했다면 양방향 연관 관계가 되는 것이다. <br>

<br>

### 연관 관계의 주인

두 객체(A, B)가 양방향 관계를 맺을 때, 연관 관계의 주인을 정해야 한다. <br>
연관 관계의 주인을 지정하는 것은 두 단방향 관계 (A -> B, B -> A) 중, 제어 권한을 갖는 실질적인 관계가 어떤 것인지 JPA에게 알려준다고 생각하면 된다. <br>
연관 관계의 주인은 연관 관계를 갖는 두 객체 사이에서 조회, 저장, 수정, 삭제를 할 수 있지만, 연관 관계의 주인이 아니면 조회만 가능하다. <br>
연관 관계의 주인이 아닌 객체에서 `mappedBy` 속성을 사용해서 주인을 지정해 주어야 한다.

----------






















