## 쿠키, 세션, JWT

기본적인 로그인은 아이디 비밀번호를 입력받아 백엔드에서 정상 확인 후 DB 에서 사용자를 확인한다.

이후 어떤 인증 수단을 사용할 것인지에 따라 로그인 구현 방향과 개념이 달라진다.

###  HTTP 통신 특징

웹에서 데이터를 교환하기 위해서 HTTP 통신을 해야한다. 로그인 인증도 마찬가지다.    
프론트에서 백으로 데이터를 보낼 때, fetch나 axios같은 HTTP 비동기 통신 라이브러리를 사용하게 된다.

HTTP 통신은 OSI 7계층에서 Application(응용) 에 해당한다. HTTP 특징으로는 비연결성과 무상태성이 있다. 서버와 클라이언트가 항상 연결되어 있는 것이 아니라 클라이언트가 요청을 보내면 순간 연결이 되고, 서버가 응답을 보내면 통신은 종료된다. 상태를 저장하지 않아 자원 낭비를 방지한다는 장점이 있다.   
그러나 이 특징으로 인해 로그인 후 다음 요청이 왔을 때, 서버는 방금 로그인 한 유저인지 알 수 없다.   
이 문제를 해결하기 위해서 세션/쿠키를 이용한 방법과 토큰 기반  인증 (JWT) 같은 인증 수단이 필요하다.

### Cookie 와 Web Storage

HTTP는 무상태성(Stateless)이다. 하지만 유저 정보, 지역에 따른 언어 등 여러 기능들을 지원하기 위해서 Cookie와 Web Storage가 생겼다. 

Web Storage는 Cookie에 비해 큰 데이터를 저장할 수 있고, 브라우저에 로컬로 저장된다. 그리고 서버로는 데이터가 전송되지 않는다는 특징이 있다. 

- Web Storage
	- Local Storage : 만료 기간이 없고, 도메인이 다른 경우 접근이 불가능하며 브라우저를 종료해도 유지된다.
	- Session Storage : 탭에 따라 개별적으로 저장되며, 탭이 종료될 때 데이터가 만료되고 같은 도메인이여도 세션이 다르면 데이터에 접근이 불가능하다.
	- 공통점 : Window 객체 안에 있다.
	- 단점 : XSS 공격으로 정보를 쉽게 탈취당할 수 있다.

Cookie는 Web Storage 에 비해 적은 데이터를 저장할 수 있지만 서버에 전송할 수 있기에 서버 데이터를 공유하는 용도로 사용된다. 로그인 시 쿠키에 상태 값을 넣어 보내주면 무상태성을 보완할 수 있다.

- 만료기간
	- 영구 쿠키(Persistent Cookie) : 만료 기간이 있다.
	- 세션 쿠키(Session Cookie) : 만료 기간이 없어 브라우저 종료 시 삭제된다.
- 도메인
	- First Party Cookie : 같은 도메인 또는 서버 도메인에서 생성된 쿠키
	- Third Party Cookie : 다른 도메인에서 생성된 쿠키

SSR(Server Side Rendering)에서 Local Storage의 값을 알 수 없기 때문에 쿠키를 활용하여 FrontEnd의 생산성을 높이기도 한다. 또한, 쿠키의 HttpOnly 옵션을 통해 Script를 이용한 XSS 공격을 방지할 수 있고, Secure 옵션을 통해 쿠키를 HTTPS로만 전송되게 만들어 보안 수준을 높일 수 있다.

하지만 로그인 정보를 클라이언트 브라우저의 작은 텍스트 조각인 쿠키에 저장하기에는 여전히 보안이 취약하다.   
스니핑같은 공격에 탈취 가능하고, 쿠키에 대한 정보를 HTTP Header에 계속해서 추가해서 보내게 되어 많은 트래픽을 발생기킬 수 있다.

### Session

쿠키와 다르게 세션은 클라이언트의 인증 정보를 서버에 저장하고 관리한다. 그리고 세션 인증 방식에서 세션 ID를 쿠키에 담아 통신한다.

#### 인증(Authentication)

1. 사용자가 아이디와 패스워드를 입력하여 백엔드에 HTTP Request를 보낸다.
2. 백엔드는 DB에서 확인한다.
3. 성공 시 서버는 세션을 생성하고 저장한다. (메모리, DB, Redis 등)
4. 백엔드로 부터 받은 세션 ID를 쿠키에 담아 Front에 반환한다. Front는 받은 세션ID를 쿠키에 저장한다.

#### 인가(Authorization)

1. 로그인 이후 요청에서 세션ID가 저장된 쿠키를 함께 보낸다.
2. 서버에서 세션ID를 확인한다.
3. 로그인한 유저의 요청 정보를 반환한다.

### Session / Cookie 인증 장단점

유저는 세션ID만 가지고 있고, 중요한 정보는 서버에 있어서 탈취 당해도 노출될 정보는 세션ID 밖에 없다.   
하지만 해커가 세션 ID로 클라이언트인척 정보를 탈취할 수 있다. 그래도 세션/쿠키 방식은 서버에서 세션을 관리하므로 의심되면 연결을 끊을 수 있다. 유효 기간을 두는 것도 좋은 방법이다.   
세션/쿠키 방식은 고유한 세션ID만 사용하기에 서버에서 일일이 유저 정보를 확인하지 않아도 어떤 유저인지 쉽게 알 수 있다.

단점은 서버에서 세션을 관리해 요청이 많아질 경우 부하가 생길 수 있고, 서버가 터지면 아무것도 할 수 없다.

> 웹 어플리케이션에서 세션을 관리할 때 자주 사용되는 쿠키는 단일 도메인 및 서브 도메인에서만 작동되도록 설계되어있다. 따라서 여러 도메인에서 관리하는 것은 번거롭다

---

https://velog.io/@leehyunho2001/%EB%A1%9C%EA%B7%B8%EC%9D%B8
