## 커넥션 풀

애플리케이션이 데이터베이스를 사용하기 위해서는 커넥션을 맺어야 한다.   
커넥션을 생성하고 소멸시키는 비용이 크기 때문에 커넥션 풀을 세팅해두고 (기본 10) 애플리케이션이시작하는 시점에 커넥션을 미리 다 만들어 놓고 이를 재활용하면서 사용한다.

스프링 부트 2.0 부터 hikariCP를 기본 커넥션 풀로 사용한다.

### HikariCP

HikariCP는 가벼운 용량과 빠른 속도를 가지는 JDBC의 커넥션 풀 프레임워크이다. 

![[Pasted image 20230523074618.png]]

커넥션 풀의 크기가 너무 적으면 커넥션을 획득하기 위해 대기하고 있는 Thread가 ㅁ낳아질 것이다. 이러한 문제는 커넥션 풀의 크기를 늘려주면 해결할 수 있다.

### 커넥션 풀의 크기와 성능

커넥션 풀이 크면 Connection을 사용하는 주체인 Thread의 개수보다 커넥션 풀의 크기가 크면 사용되지 않고 남는 커넥션이 생겨 메모리 낭비가 발생한다.

MySQL 공식 레퍼런스에서 600여 명의 유저를 대응하는데 15~20개의 커넥션 풀로 충분하다고 하였다. MySQL은 최대 연결 수를 무제한으로 설정하고 테스트를 진행하면서 최적화된 값을 찾는 것을 추천한다.

우아한 형제들 테크 블로그에서 공식을 추천하고 있다.
```
pool size = Tn * (Cm - 1) + 1
```
- Tn = 전체 Thread 개수
- Cm = 하나의 Task에서 동시에 필요한 Connection 수
