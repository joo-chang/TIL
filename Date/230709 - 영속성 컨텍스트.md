## 영속성 컨텍스트

애플리케이션과 데이터베이스 사이에서 객체를 보관하는 가상의 데이터베이스 같은 역할을 한다.

엔티티 매니저를 통해 엔티티를 저장하거나 조회하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관하고 관리한다.

JPA는 보통 트랜잭션을 커밋하는 순간 영속성 컨텍스트에 새로 저장된 엔티티를 데이터베이스에 반영하는데 이를 flush라 한다.


### 생명 주기

- 영속
	- 영속성 컨텍스트에 저장된 상태
- 준영속
	- 영속성 컨텍스트에 저장되었다가 분리된 상태
- 비영속
	- 영속성 컨텍스트와 전혀 관계없는 상태
- 삭제
	- 삭제된 상태


### 영속성 컨텍스트의 이점

- 1차 캐시
	- 영속성 컨텍스트에서 먼저 조회가 가능하며 없으면 DB에서 조회해서 가져온다.
- 동일성 보장
	- == 비교가 가능하다.
- 쓰기 지연
	- 트랜잭션 커밋 전까지 SQL을 바로 보내지 않고 모아서 보낼 수 있다.
- 변경 감지 (더치 체킹)
	- 1차 캐시에 들어온 데이터를 스냅샷 찍어두고 커밋 시점에 비교하여 Update SQL을 생성한다.
- 지연 로딩
	- 엔티티에서 연관관계가 있는 엔티티를 불러올 때 프록시 객체로 가져오고 사용 시점에 프록시 객체가 디비에서 가져온다. 가져오는 시점을 뒤로 미룬다.
