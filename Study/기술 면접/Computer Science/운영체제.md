# 운영체제란?

## 운영체제
운영체제란 컴퓨터 시스템의 핵심 소프트웨어로, 컴퓨터 하드웨어와 응용프로그램 간의 상호작용을 관리하고 제어하는 역할을 한다.
<br>

## 운영체제 목적 
사용자와 하드웨어 사이의 인터페이스를 제공해 효율적으로 응용 프로그램이 동작하도록 지원하고, 시스템 자원을 효율적으로 관리하여 응용 프로그램이 원할하게 동작할 수 있도록 한다.
<br>

## 운영체제 역할

### CPU 스케줄링과 프로세스 관리
CPU 소유권을 어떤 프로세스에 할당할지, 프로세스의 생성과 삭제, 자원 할당 및 반환을 관리한다. 또한, 프로세스 간 통신(IPC), 동기화 및 데드락 감지 및 해결과 같은 기능을 제공하여, 멀티태스킹 환경에서 프로세스가 원활히 실행될 수 있도록 한다.

### 메모리 관리
한정된 메모리를 어떤 프로세스에 얼만큼 할당해야 하는지 관리한다.

### 파일 시스템 관리
파일 생성, 읽기, 쓰기 등 파일 시스템 관련 작업을 관리한다.

### I/O 디바이스 관리
I/O 디바이스와 컴퓨터 간에 데이터를 주고 받는 것을 관리한다.
<br>

## 운영체제 구조

### 커널 (Kernel)
커널은 용어 자체로도 '핵심의' 로 운영체제에서 중요한 역할이다. 
커널은 전반적으로 **프로세스**를 뜻한다.
프로세스 관리, 메모리 관리, 저장공간 관리, 연결된 장치 관리 등 컴퓨터에 속한 모든 자원을 관리하는 역할을 한다.

### 인터페이스 (Interface)
인터페이스는 사용자의 명령을 컴퓨터에 전달하고 결과를 알려주는 소통 역할을 한다.
인터페이스 종류는 GUI (Graphical User Interface), CLI(Command Line Interface) 가 대표적이다.
GUI는 그래픽 요소를 사용하여 소통하게끔 하여 사용자 편의성을 가진 인터페이스이고, CLI는 명령어로 소통하는 인터페이스이다.

### 시스템 콜 (System Call)
시스템 콜은 운영체제가 커널에 접근하기 위한 인터페이스이다.
사용자나 프로그램이 직접적으로 컴퓨터 자원에 접근하는 것을 막고 커널을 보호하기 위해 만든 코드 집합이다. 운영체제는 시스템 콜을 통해서만 커널에 접근 하도록 디자인되었다.

### 드라이버 (Driver)
드라이버는 프린터 키보드 등 하드웨어 장치와 운영체제 간의 통신을 가능하게 하는 소프트웨어이다. 
<br>

> 운영체제는 컴퓨터 하드웨어와 응용프로그램 간의 인터페이스 역할을 하는 컴퓨터 시스템 핵심 소프트웨어입니다. 
> 운영체제는 자원 관리, 프로세스 관리, 메모리 관리, 파일 시스템, 입출력 관리 등의 역할을 합니다.

---
# 메모리 구조

- 메모리 공간 종류 4가지 : 코드 영역, 데이터 영역, 힙 영역, 스택 영역

![[Pasted image 20240312160044.png]]

### 코드 영역 (Code / Text)
실행할 프로그램의 코드가 CPU가 해석 가능한 기계어로 저장된다. CPU는 이 영역에서 명령어를 하나씩 가져와 처리한다.

### 데이터 영역 (Data)
전역 변수와 static 변수가 저장된다.

### 스택 영역 (Stack)
지역 변수, 매개변수, 실행되는 함수에 의해 늘어나거나 줄어드는 메모리 영역이다. 함수가 호출될 때마다 환경 등 특정 정보가 저장되는 독립적인 공간이다.
스택은 함수 호출과 함께 할당되며, 호출 종료 시 소멸된다.
(stack 영역 초과 시 stack overflow 에러 발생)
### 힙 영역 (Heap)
생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재하는 공간이다. 
사용자가 직접 관리하는 영역으로 메모리 공간이 동적으로 할당되고 해제된다. 

위 그림을 보면 스택, 힙은 화살표로 되어 있는데, 프로세스가 실행되는 동안 크기가 늘었다 줄어들었다하는 동적 공간이기 때문에 화살표로 표현되었다.

> 메모리에는 크게 코드, 데이터, 힙, 스택 영역이 있습니다.
> `코드`는 소스코드가 들어가는 공간이고, `데이터`는 전역 변수, static 변수가 할당되는 부분입니다.
> `힙`은 사용자가 직접 관리하는 영역으로 데이터가 동적으로 할당되는 공간이고,
> `스택`은 함수의 호출 정보, 지역 변수, 매개변수들에 의해 늘어나거나 줄어드는 메모리 영역입니다. 함수 호출 시 할당되며, 종료 시 소멸됩니다.

---
# Process, Thread

- 프로세스 : 운영체제로부터 자원을 할당받은 작업의 단위. 실행중인 프로그램
- 스레드 : 프로세스 내에서 동시에 진행되는 작업 갈래, 흐름 단위 (멀티 스레드)


프로세스는 각각의 독립된 메모리 영역(코드, 데이터, 힙, 스택)을 할당 받는다.
스레드는 프로세스 내에서 각각 스택만 따로 할당 받고, 코드, 데이터, 힙은 프로세스 간 공유 된다.

> `프로세스`는 실행중인 프로그램이고, 
> `스레드`는 프로세스 안에서 실행되는 흐름 단위입니다.
> `프로세스`는 메모리와 CPU를 프로세스마다 할당 받아서 사용하는데, 
> `스레드`는 프로세스 안에서 다른 스레드와 메모리와CPU를 공유해서 사용합니다. 스레드는 스택 메모리만 각각 할당 받습니다.

---
# Thread에서 독립적인 Stack 메모리 영역이 필요한 이유


스레드는 프로세스가 할당 받은 자원을 이용하는 실행 단위이다. 
스레드끼리 프로세스의 자원을 공유하면서 프로세스의 실행 흐름의 일부가 되기 때문에,동시 작업이 가능하다.

스레드는 프로세스의 4가지 메모리 영역 중 Stack만 할당받아 복사하고, 나머지 메모리 영역을 프로세스 내의 다른 스레드들과 함께 공유한다. (각각의 스레드는 별도의 Stack 을 가지고 있다.)

스택은 함수 호출 시 전달되는 인자, 되돌아갈 주소값, 함수 내에서 선언하는 변수 등을 저장하는 메모리 공간으로, 독립적인 함수 호출이 가능하다. 이는 독립적인 실행 흐름이 추가 된다는 말이다.

결과적으로 스레드에서 독립적인 Stack 메모리 영역이 필요한 이유는 하나의 프로세스를 다수의 실행 단위인 스레드로 구분하여 자원을 공유하고, 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 올리기 위해서다.

> 스레드에 독립적인 Stack 영역이 필요한 이유는 하나의 프로세스를 다수의 실행 단위인 스레드로 구분하여 자원을 공유하고, **자원의 생성과 관리의 중복성을 최소화**하여 수행 능력을 올리기 위해서입니다.


---
# 멀티 프로세스와 멀티 스레드 비교

## 멀티 프로세스

멀티 프로세스는 운영체제에서 하나의 응용 프로그램에 대해 동시에 여러 개의 프로세스를 실행할 수 있게 하는 기술을 말한다.
보통 하나의 프로그램은 하나의 프로세스가 메모리에 생성되지만 부가 기능을 위해 여러 개의 프로세스를 생성하는 것이다.

### 장점

#### 프로그램 안전성

멀티 프로세스는 각 프로세스가 독립적인 메모리 공간을 가지므로, 한 프로세스가 비정상적으로 종료되어도 다른 프로세스에 영향을 주지 않는다. 따라서 프로그램 전체의 안전성을 확보할 수 있다.

#### 프로그램 병렬성

멀티 프로세스와 여러 개의 CPU 코어를 활용하여, 다중 CPU 시스템에서 각 프로세스를 병렬적으로 실행하여 성능을 향상 시킬 수 있다.

이 장점은 멀티 스레드의 장점이기도 하다.

#### 시스템 확장성

멀티 프로세스는 각 프로세스가 독립적이므로, 새로운 기능이나 모듈을 추가하거나 수정할 때 다른 프로세스에 영향을 주지 않는다. 따라서 시스템 규모를 쉽게 확장할 수 있다.

### 단점

#### Context Switching Overhead

멀티 태스킹 구성의 핵심 기술인 컨텍스트 스위칭 과정에서 성능 저하가 올 수있다. 
특히 프로세스를 컨텍스트 스위칭하면 `CPU는 다음 프로세스의 정보를 불러오기 위해 메모리를 검색하고, CPU 캐시 메모리를 초기화하며, 프로세스 상태를 저장하고, 불러올 데이터를 준비해야하기 때문에` 빈번한 컨텍스트 스위칭 작업으로 인해 오버헤드가 발생할 수 있다.
반면에, 스레드를 컨텍스트 스위칭하면 프로세스 스위칭보다 가벼워 훨씬 빠르고 좋다.

따라서, 멀티 프로세스 환경에서는 Context Switching Overhead를 최소화하는 방법이 중요하다.
프로세스 수를 적정하게 유지하거나, I/O 바운드 작업이 많은 프로세스와 CPU 바운드 작업이 많은 프로세스를 분리하여 관리하고, CPU 캐시를 효율적으로 활용하는 등의 방법을 고려해 봐야 한다.

#### 자원 공유 비효율성

멀티 프로세스는 각 프로세스가 독립적인 메모리 공간을 가지므로, 메모리 사용량이 증가하게 된다.
각 프로세스 간 자원 공유가 필요할 경우 어렵고 복잡한 통신 기법인 IPC(Inter-Process Commnuication) 를 사용해야 한다.
IPC는 실행 중인 프로세스 간에 정보를 주고받는 메커니즘을 말한다. 이를 위해 파이프, 소켓, 메세지 큐 등 다양한 방법이 사용된다. 그런데 IPC 자체로 오버헤드가 발생한다. 예를 들어, 파이프나 소켓과 같은 IPC 기법은 데이터를 복사하거나 버퍼링하는 과정에서 성능 저하가 발생할 수 있기 때문이다. 또한 코드의 복잡도를 증가시킨다.

<br>

## 멀티 스레드

스레드는 하나의 프로세스 내에 있는 실행 단위이다. 멀티 스레드는 하나의 프로세스 안에 여러 개의 스레드가 있어, 두 가지 이상의 동작을 동시에 처리하도록 하는 것이다.

멀티 프로세스와의 차이점은 웹 브라우저로 예시를 들어보면 웹 브라우저에서 여러 탭이나 여러 창이 각각 프로세스로 멀티 프로세스이고, 멀티 스레드는 단일 탭 내에서 브라우저 이벤트 루프, 네트워크 처리, I/O 및 기타 작업을 관리하고 처리하는 데 사용된다.

### 장점

많은 운영체제들이 멀티 프로세싱을 지원하지만 멀티 스레드를 기본으로 하고 있다. 

#### 프로세스보다 가벼움

스레드는 프로세스 내에서 생성되기 때문에 실행 환경 설정 작업이 매우 간단하여 생성 및 종료가 빠르다.
또한, 코드, 데이터, 힙 영역을 서로 공유하기 때문에 데이터 용량이 프로세스보다 작다.

#### 자원의 효율성

멀티 스레드는 하나의 프로세스 내에서 생성되기 때문에, 공유 메모리에 대해 스레드 간 자원 공유가 가능하다. 

#### Context Switching 비용 감소

스레드도 컨텍스트 스위칭 오버헤드가 존재하지만, 프로세스 컨텍스트 스위칭에 비하면 훨씬 낮다.
프로세스 컨텍스트 스위칭 시 CPU 캐시를 모두 초기화하고, 새로운 프로세스 정보를 적재해야 하므로 높은 비용이 든다. 하지만 스레드는 공유 자원을 제외한 스레드 정보(stack, register) 만 교체하면 되므로 상대적으로 낮다.

#### 응답 시간 단축

앞선 장점들로 인해 응답 시간이 빠르다.

### 단점

#### 안정성 문제

멀티 스레드는 하나의 스레드에서 문제가 발생하면 다른 스레드들도 영향을 받아 전체 프로그램이 종료될 수 있다.
하지만 이 문제는 적절한 예외 처리, 에러 발생 시 새로운 스레드를 생성하거나 스레드 풀에서 잔여 스레드를 가져오는 등의 방법으로 해결할 수 있다.

#### 동기화로 인한 성능 저하

멀티 스레드는 여러 개의 스레드가  공유 자원에 동시 접근할 수 있기 때문에 동기화 문제가 발생할 수 있다. 따라서 스레드 간 동기화(syncronized)는 데이터 접근을 제어하기 위한 필수적인 기술이다.

동기화 작업은 여러 스레드 접근을 제한하는 것이기 때문에 병목 현상이 일어나 성능 저하될 가능성이 높다.

이를 해결하기 위해 임계 영역에 대해 뮤텍스, 세마포어 방식을 활용한다.

#### 데드락 (교착 상태)

데드락은 다수의 프로세스나 스레드가 서로의 자원을 점유하고 무한정 자원을 기다리는 상황에서 발생하는 교착상태를 말한다.

데드락 방지를 위해 상호배제, 점유와 대기, 비선점, 순환대기 등의 알고리즘을 사용하면 된다.

#### Context Switching Overhead

컨텍스트 스위칭 오버헤드 비용 자체를 무시할 수는 없다. 스레드 수가 많을 수록 컨텍스트 스위칭이 많이 발생하고, 성능 저하로 이어질 수 있다.

>**멀티 프로세스**는 여러 개의 독립적인 프로세스가 동시에 실행되는 것을 말합니다. 각 프로세스는 독립된 메모리 공간(코드, 데이터, 힙, 스택 등)을 할당받으며, 다른 프로세스의 자원에 접근할 수 없습니다. 프로세스 간 통신을 위해서는 Inter Process Communication(IPC) 기법(예: 파이프, 소켓, 공유 메모리 등)을 사용해야 합니다. 멀티 프로세스는 하나의 프로세스에 문제가 발생해도 다른 프로세스에는 영향을 미치지 않는 격리성을 가지고 있지만, 프로세스 간 컨텍스트 스위칭이나 IPC로 인한 오버헤드가 크다는 단점이 있습니다.
> **멀티 스레드**는 하나의 프로세스 내에서 여러 개의 스레드가 동시에 실행되는 것을 말합니다. 모든 스레드는 부모 프로세스의 자원(메모리 공간)을 공유하며, 각각 별도의 스택을 가지고 있어 독립적인 실행 흐름을 가집니다. 멀티 스레드는 스레드 간 데이터 공유가 용이하고, 컨텍스트 스위칭 비용이 상대적으로 낮아서 효율적인 자원 사용과 빠른 실행 속도를 가질 수 있습니다. 하지만, 스레드 간 자원 공유로 인해 데이터 일관성 및 동기화 문제가 발생할 수 있으며, 한 스레드에서 발생한 문제가 전체 프로세스에 영향을 미칠 수 있다는 단점이 있습니다.

---
# 문맥 교환 (Context Switch)

문맥 교환은 멀티태스킹 운영체제에서 CPU가 이전 작업(프로세스 or 스레드)에서 다른 작업으로 전환할 때 발생하는 과정을 말한다. 이 과정에서 운영체제는 현재 실행 중인 작업의 상태(문맥)을 저장하고, 다음에 실행할 작업의 상태를 메모리에 불러와 CPU에 적재한다. 

이때 한 프로세스의 문맥은 프로세스 제어 블록(PCB)에 기록되어 있다.

## 문맥 교환 시점

### 멀티 태스킹

멀티 태스킹은 다수의 프로세스가 하나의 CPU 자원을 나눠 사용하는 것이다.
실행 가능한 프로세스들이 운영체제의 스케줄러에 의해 조금씩 번갈아 수행되는데, 프로세스가 **CPU를 할당 받을 때** 문맥 교환이 일어난다.
매우 빠른 속도로 처리되기 때문에 동시에 처리되는 것처럼 느껴진다.

### 인터럽트 처리

인터럽트는 컴퓨터 시스템에서 예외 상황이 발생했을 때 CPU에게 알려 처리할 수 있도록 하는 것이다.
**인터럽트가 발생했을 때** 문맥 교환이 일어난다.

- I/O request : 입출력 요청
- time slice expried : CPU 사용시간 만료
- fork a child : 자식 프로세스 생성
- wait for an interrupt : 인터럽트 처리 대기

### 사용자 및 커널 모드 전환

운영체제에서 사용자 모드와 커널 모드 사이의 전환이 필요할 때 필수는 아니지만 운영체제에 따라 문맥 교환이 발생한다.


## 문맥 교환이 일어나는 과정

1. 요청 발생 : 인터럽트 또는 트랩에 의한 요청이 발생
2. PCB에 저장 : 운영체제는 현재 실행중인 프로세스의 정보를 PCB에 저장
3. CPU 할당 : 운영체제는 다음 프로세스의 정보를 PCB에서 가져와 CPU를 할당

<br>

---
# Process Control Block (PCB)

프로세스 제어 블록은 특정한 프로세스를 관리할 필요가 있는 정보를 포함하는 운영체제 커널의 자료구조이다. 

운영체제가 프로세스 스케줄링을 위해 프로세스에 관한 모든 정보를 가지고 있는 데이터베이스를 PCB라 한다.

운영체제에서 프로세스는 PCB로 나타내어지며, 프로세스에 대한 중요한 정보를 가지고 있는 자료이다. 각 프로세스가 생성될 때마다 고유의 PCB가 생성되고, 프로세스가 완료되면 PCB는 제거된다.

프로세스는 CPU가 처리하던 작업의 내용들을 자신의 PCB에 저장하고, 다음에 다시 CPU를 점유하여 작업을 수행할 때 PCB로 부터 해당 정보들을 CPU에 넘겨와서 계속해서 하던 작업을 진행할 수 있게 된다.



---


---
# CPU 스케줄러

- 준비 큐 있는 프로세스에 대해 CPU를 할당하는 방법

> CPU 스케줄러는 운영체제에서 프로세스들이 CPU를 사용하기 위해 경쟁하는 상황에서 어떤 프로세스에 CPU를 할당할지 결정하는 역할을 하는 부분입니다.
> 종류는 FCFS, SJF, SRT, Priority Scheduling, Round Robin이 있습니다.

---
## 가상 메모리란?

- 사용하는 부분만 메모리에 올리고, 나머지는 디스크에 보관하는 것

> 모든 프로세스에게 메모리를 할당하기에는 메모리의 크기가 한계가 있어서 사용하는 방법이다. 프로세스에서 사용하는 부분만 메모리에 올리고, 나머지는 디스크에 보관하는 기법을 가상 메모리라고 한다.

---
## 데드락이란?

- 프로세스가 자원을 얻지 못해 다음 작업을 못하는 상태

**데드랑 발생 조건**

데드락은 아래 네 가지 조건이 동시에 성립될 때 발생한다.

- 상호 배제 : 자원은 한 번에 한 프로세스만이 사용할 수 있어야 한다.
- 점유 대기 : 최소 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 한다.
- 비선점 : 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 뺏을 수 없다.
- 순환 대기 : 프로세스들이 각각 점유한 자원을 대기하고, 요구해야 한다.

> 데드락은 프로세스가 자원을 얻지 못해 다음 작업을 못하는 상태이다.
> 예를 들어, P1, P2가 각각 자원 A와 B를 얻어야 되는데, P1은 A를 P2는 B를 가지고 있어서 서로 무한정 대기하는 상태를 데드락이라고 한다.
> 데드락은 상호 배제, 점유 대기, 비선점, 순환 대기 네가지가 동시에 성립될 때 발생한다.


- 운영체제란?
- 실행파일 생성 과정
- 프로그램 실행과정
    - 명령어사이클
- 캐시란?
- 캐시라인
- 메모리구조
    - 전역변수와 정적변수의 차이
    - Heap, Stack 비교
    - 가시성(visibility)과 원자성(atomocity)
    - 유효주소, 주소지정방식
    - 메모리 할당 알고리즘
- 프로세스, 스레드
    - 멀티 프로세스와 멀티 스레드
    - 스레드와 프로세스 콘텍스트 스위치 차이 이유
    - 프로세스 스케줄러에 대해
    - CPU 스케줄러
- 스레싱이란?
- IPC란?
- Race Condition?
- User, Kernel 스레드 차이
- 가상 메모리
    - 메모리 단편화
- 페이징기법
- 세그먼테이션 기법ㅏ
- 메모리풀
- 페이지 교체 알고리즘
- MMU란?
- TLB란?
- 페이지 부재시 절차
- 인터럽트란?
    - System Call
- 프로세스 제어 명령
- fork(), vfork() 차이
- 시스템콜과 서브루틴 차이
- 블록킹, 논블록킹
- 동기, 비동기
- 동기 IO 처리과정 : 프로세스 A가 디스크에서 어떤 데이터 읽어올때 상황
- 입출력 처리방식
    - DMA
    - Cycle Stealing
- 데드락
    - 발생조건
    - 회피기법
    - 해결경험
- PCB(Process Control Block) 이란?
- Spin Lock 이란?
- 동기화 종류
- Critical Section?
- Mutex란?
- Semaphore란?
- Mutex, Semaphore 차이
- Monitor란?
- Thread-safe 란?
    - Reentrant란?
- 인터럽트, 폴링 개념 및 차이
- Fault Tolerance 란?
    - 작동절차