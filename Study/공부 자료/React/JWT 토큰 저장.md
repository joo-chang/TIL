## JWT 토큰 저장

JWT 토큰을 발급 받아 인증을 하려고 할 때, 토큰을 저장하는 방법은 `웹 스토리지`, `쿠키` 로 크게 두 가지가 있다.

<br>

### 웹 스토리지 (Web Storage)

웹 스토리지는 데이터를 서버가 아닌 클라이언트에 저장할 수 있도록 지원하는 기능이다.
쿠키와 유사하지만 쿠키는 4KB 밖에 저장 공간이 없지만, 웹스토리지는 5MB 까지 저장할 수 있다.

#### 로컬 스토리지 (Local Storage)

로컬 스토리지는 데이터를 브라우저에 반영구적으로 저장하며, 브라우저 재시작해도 남아있고 다른 창과 브라우저를 통해서도 접근 가능하다.

#### 세션 스토리지 (Session Storage)

세션 스토리지는 로컬 스토리지와 유사하지만 브라우저가 닫히면 데이터가 사라지고, 다른 창과 브라우저에 공유가 불가능하다.

<br>

웹 스토리지는 자바스크립트로 제어가 가능해 **XSS (Cross Site Scripting, XSS)** 공격에 대해 위험이 있다.

> **XXS 공격**
> 크로스 사이트 스크립팅(Cross Site Scripting, XSS)
> 해커가 사용자 브라우저에 스크립트가 실행되도록 해 사용자의 세션을 가로채거나, 웹 사이트 변조, 악의적 콘텐츠 삽입, 피싱 공격하는 것을 말한다.

<br>

---
### 쿠키 (Cookie)

쿠키는 효율적이고 안전한 웹 사용을 보장하기 위해 사용되고 있다.

쿠키는 웹사이트 접속 시 개인 장치에 다운로드 되고 브라우저에 저장되는 텍스트 파일이다.

쿠키도 자바스크립트로 접근 가능하므로 HTTP Only 옵션을 걸어줘야 한다. 
HTTPS가 적용되지 않은 이미지 등으로 인해 쿠키를 탈취당할 수 있으므로 Secure 옵션도 걸어줘야 한다.
이렇게 할 경우 자바스크립트로 쿠키 취득과, 탈취를 방지할 수 있다.

하지만 쿠키는 **CSRF (Cross-Site Request Forgery)** 공격에 취약하다.

> **CSRF**
> CSRF는 링크 또는 스크립트를 사용하여 사용자가 인증된 대상 사이트로 원하지 않는 HTTP 요청을 전송하는 것
> 즉, 로그인 된 상태에서 위험한 동작을 하게 만든다.

---
### 결론

- Refresh Token : 쿠키 
- Access Token : 로컬 스토리지

결과적으로 각각 쿠키와 로컬 스토리지에 토큰 값을 저장하게 되면, 
Refresh Token이 탈취 당하더라도 악의적인 HTTP 요청을 하는 CSRF 공격을 Refresh Token을 가지고 할 수 없기 때문에 안전하고, 
Access Token이 탈취 되더라도 토큰 만료 기간을 짧게 가져가 보안을 강화할 수 있다.

<br>

만약 Refresh Token이 탈취 된다면 위험성을 최대한 줄이기 위해 RTR (Refresh Token Rotation) 방식을 도입하기도 한다.
Refresh Token으로 Access Token을 재발급 받을 때 Refresh Token을 새로 발급해 한 번만 사용할 수 있도록 하는 방식이다. 
