MSA 에서 JWT 기반 인증/인가 전략을 어떻게 사용할지 결정하는 것은 보안 수준, 성능, 아키텍처 복잡도에 따라 달라진다.

주요 접근 방식은 크게 두 가지로 나뉜다.

## 게이트웨이에서 1회 인증 후 내부 서비스 신뢰

### 개념

API 게이트웨이에서 클라이언트로부터 전송된 JWT를 한 번 검증한 뒤, 토큰 안의 클레임(Claims) 또는 사용자 식별자(userId) 등을 추출하여 내부 서비스들로 전달한다.

내부 서비스들은 게이트웨이가 이미 검증한 정보를 신뢰하며, 추가적인 인증 절차 없이 식별 정보를 사용해 인가 로직만 수행한다.

### 장점

- 각 서비스마다 JWT 검증 로직을 구현할 필요가 없어 개발과 유지보수 부담 감소
- 인증 검증 과정이 중복되지 않아 성능상 유리
- 인프라 단에서 게이트웨이에 집중된 관리를 통해 보안 정책 변경, 로깅, 모니터링 등에 용이

### 단점

- 게이트웨이에만 신뢰해야하기 때문에, 게이트웨이 내부/외부 구간을 분리하고 내부 네트워크를 안전한 환경으로 유지해야 한다.
- 내부 서비스에서 추가적인 인증 검증을 하지 않으므로, 게이트웨이 수준의 보안이 뚫리면 내부 서비스들도 잠재적으로 영향을 받을 수 있다.

## 각 서비스에서 직접 JWT 검증

### 개념

각 서비스가 JWT 토큰을 수신할 때마다 별도로 검증한다. 이를 위해 각 서비스는 JWT 서명을 검증하는 public key를 알고 있어야 하며, 토큰 만료, 서명 위변조 여부 등을 매번 체크한다.

### 장점

- 각 서비스가 독립적인 보안 경계를 형성하므로, 게이트웨이가 해킹되거나 내부 네트워크가 노출되더라도 각 서비스는 자체 검증 과정을 통해 보안 수준을 유지할 수 있다.
- 외부 게이트웨이 외에 다른 진입점(직접 서비스 접근)이 고려되는 환경에서는 서비스별 인증 검증이 더 안전하다.

### 단점

- 모든 서비스에 JWT 검증 로직이 중복되며, 구현/유지보수 부담 증가
- 매번 검증으로 인한 성능 저하 가능
- 키 관리, 토큰 검증 로직 일관성 유지 필요

## 절충안 : 게이트웨이 검증 + Claims 전달 후 인가만 각 서비스에서 수행

일반적인 권장 패턴은 게이트웨이에서 JWT를 검증하고, 필요한 Claims(userId, roles, permissions)를 헤더나 gRPC 메타데이터 등에 담아 내부 서비스로 전달하는 방식이다.
단, 이 경우 내부 네트워크를 신뢰할 수 있는 환경(폐쇄망, Zero--Trust 네트워크 구현 등) 또는 마이크로서비스 사이 통신을 TLS 및 인증서 기반으로 안전하게 보호하는 전략을 함께 사용해 보안 수준을 유지한다.

## 결론

- 높은 보안 요구사항이 있고 내부 네트워크 침해 가능성이 큰 경우 : 각 서비스별 JWT 검증 고려
- 일반적인 MSA 환경에서 게이트웨이를 신뢰할 수 있고, 성능과 유지보수성이 중요한 경우: 게이트웨이에서 1회 검증 후 클레임을 전달, 내부 서비스에서는 인가만 수행하는 전략 활용