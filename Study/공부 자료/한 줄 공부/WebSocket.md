웹 프로젝트에 채팅 기능을 구현해야 하는데 WebSocket을 사용해야 한다고 한다.
웹 소켓이 무엇이고, 왜 사용해야 하는지 간단하게 알아보자.

<br>

### HTTP 통신의 특징과 한계

HTTP 통신은 클라이언트와 서버 간 통신을 위한 전송 프로토콜이다.

**HTTP 기본 원리**

1. Client가 Server에게 받고 싶은 정보를 Request에 담아 전송한다.
2. Server는 Client의 Request에 맞는 Response를 준다.
3. Client는 Server에게 받은 데이터를 사용한다.

Client가 Server에 요청을 해야 Server가 그에 맞는 데이터를 제공해주는 방식이다.

그래서 HTTP 통신의 특징은 `Stateless`, `Connectionless` 가 있다.
요청/응답 후에는 연결이 끊어져 독립된 상태를 유지한다.

<br>

---
### WebSocket

> 웹 소켓은 클라이언트에서 주기적으로 서버 측에 데이터 확인 요청을 하는 Polling 기법과 달리 새로운 데이터가 들어오면 서버가 먼저 클라이언트에게 데이터를 전송하는 기술이다.

실시간 채팅 기능을 구현하기 위해서는 HTTP 통신의 기존 방법으로는 한계가 있다.

채팅이 이루어지려면

1. Client가 Server에게 메세지를 전송하고, 
2. Server는 그 메세지를 다른 Client에게 전송해야 한다.

하지만 기본적으로 Client가 요청을 해야 Server가 응답을 줄 수 있으므로 2번 행위가 불가능하다.

<br>

물론 기존 방식으로 해결할 수 있긴하다.

1. ajax의 비통기 통신을 통해 주기적으로 Server한테 자신에게 보낼 정보가 있는지 Check하는 요청을 보낸다. (Polling 기법)
2. 페이지가 이동할 때마다 자신에게 온 정보가 있는지 함께 요청한다.

위 방법은 문제점이 있는데, 
1번은 주기적으로 ajax를 사용해야 하므로 서버에 무리가 갈 수 있고, 실시간도 아니다.
2번은 페이지를 이동할 때만 받아올 수 있기 때문에 채팅이라고 할 수 없다.

<br>

이를 보완하기 위해 웹 소켓이 등장했다.
웹 소켓은 IETF에 의해 RFC 6455로 표준화된 기술이다.
HTTP 와 다르게 전이중 통신을 지원하기 때문에 Client 요청 없이 Server가 Client에게 정보를 전송할 수 있다.

<br>

소켓은 클라이언트와 서버의 연결을 유지한 채로 연결이 끊어지기 전까지 지속적으로 양방향 통신을 할 수 있는 장점이 있다.
이러한 양방향 통신을 가능하도록 한 프로토콜을 WebSocket Protocol 이라고 한다.

하지만 이런 웹 소켓에는 치명적인 단점이 있다.
특정 브라우저나 지원하지 않는 버전이 있다.

이러한 미지원 브라우저에 대한 문제점을 해결하기 위해 `Socket.io` 와 `SockJS` 기술이 등장했다.
아래에서 SockJS와 Socket.io 에 대해 알아보자.

<br>

---
### SockJS

SockJS는 웹 소켓과 유사한 객체를 제공하는 브라우저 JS 라이브러리다.

브라우저와 웹 서버 사이에 대기 시간이 짧은 전이중 도메인 간 통신 채널을 생성하는 일관된 브라우저 간 JavaScript API를 제공한다.

SockJS는 내부적으로 웹 소켓을 먼저 사용하려고 시도하고, 실패하면 HTTP Streaming, Long-Polling 과 같은 HTTP 기반의 다른 기술로 전환해 연결을 시도한다.

> Socket.io는 Spring에서 지원하지 않기 때문에 SockJS를 사용할 것이다.

<br>

### Socket.io

Socket.io는 클라이언트와 서버 간의 짧은 대기 시간, 양방향 및 이벤트 기반 통신을 가능하게 하는 node.js 기반의 라이브러리이다. WebSocket 프로토콜 위에 구축되었고, HTTP 긴 폴링 또는 자동 재연결에 대한 폴백과 같은 추가 기능을 제공한다.

<br>

### STOMP

STOMP (Simple Text Oriented Messaging Protocol)은 메세지를 효율적으로 전송하기 위해 탄생한 프로토콜이다.

STOMP는 WebSocket 위에서 동작하는 프로토콜로 Client와 Server가 .

STOMP는 메시지 기반의 프로토콜로, WebSocket을 통해 메시지를 주고받을 때 사용된다. STOMP는 간단하면서도 유연한 메시지 프로토콜로, 전송할 메세지 유형, 형식, 내용을 명시적으로 정의하는 매커니즘이다.

WebSocket은 연결된 소켓에게 데이터 처리를 직접하는데 STOMP는 subscriber, sender, broker를 따로 두어 처리하게된다.
STOMP를 사용하면 메세징 프로토콜이나 형식을 개발할 필요가 없어 개발 시 매우 유용하다.

Spring에서는 SockJS와 STOMP를 쉽게 통합할 수 있는 지원을 제공하기 때문에 일반적으로 많이 사용한다.

<br>

> SockJS는 브라우저 호환성을 강화하고, STOMP는 메시지 기반 프로토콜로 WebSocket 통신을 보다 쉽게 다루기 위해 함께 사용한다. 
이는 브라우저 호환성과 메시지 전달의 효율성을 높이는 데 도움이 된다.



